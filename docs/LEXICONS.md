# Skyreader Lexicon Schemas

This document describes the AT Protocol lexicon schemas used by Skyreader.

## Overview

[Lexicons](https://atproto.com/specs/lexicon) are AT Protocol's schema system. They define the structure of records stored in a user's Personal Data Server (PDS). Skyreader uses custom lexicons under the `app.skyreader` namespace to store feed subscriptions, reading progress, and social interactions.

All records use `tid` (timestamp identifier) as their key, which is automatically generated by the AT Protocol SDK.

## Record Types

Skyreader defines five record types across two collections:

| Collection | Record Type | Purpose |
|------------|-------------|---------|
| `feed` | `subscription` | RSS/Atom feed subscriptions |
| `feed` | `readPosition` | Read state and starring for articles |
| `social` | `share` | Shared articles with optional notes |
| `social` | `follow` | In-app follow relationships |
| `social` | `shareReadPosition` | Read state for others' shares |

---

## Feed Collection

### `app.skyreader.feed.subscription`

A subscription to an RSS/Atom feed.

**Schema Location:** `lexicons/app/skyreader/feed/subscription.json`

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `feedUrl` | uri | Yes | The URL of the RSS/Atom feed |
| `title` | string (max 512) | No | User-provided or auto-detected feed title |
| `siteUrl` | uri | No | The main website URL associated with the feed |
| `category` | string (max 128) | No | User-defined category/folder for organization |
| `tags` | array of string (max 10 items, each max 64) | No | User-defined tags for the subscription |
| `createdAt` | datetime | Yes | When the subscription was created |
| `updatedAt` | datetime | No | When the subscription was last updated |

---

### `app.skyreader.feed.readPosition`

Reading position/progress for a feed item. Used to track which articles have been read and starred.

**Schema Location:** `lexicons/app/skyreader/feed/readPosition.json`

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `subscriptionUri` | at-uri | No | AT URI reference to the subscription record |
| `itemGuid` | string (max 2048) | Yes | The GUID/ID of the feed item (from RSS) |
| `itemUrl` | uri | No | The URL of the feed item |
| `itemTitle` | string (max 512) | No | Cached title of the item |
| `readAt` | datetime | Yes | When the item was marked as read |
| `scrollPosition` | integer (0-100) | No | Scroll position percentage for partial reading |
| `starred` | boolean | No | Whether the item is starred/favorited (default: false) |

---

## Social Collection

### `app.skyreader.social.share`

A shared article with optional commentary. These records are aggregated by the backend via the Jetstream firehose to build social feeds.

**Schema Location:** `lexicons/app/skyreader/social/share.json`

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `subscriptionUri` | at-uri | No | AT URI of the source subscription |
| `feedUrl` | uri | No | URL of the RSS feed this article came from |
| `itemUrl` | uri | Yes | The URL of the shared article |
| `itemTitle` | string (max 512) | No | Title of the shared article |
| `itemAuthor` | string (max 256) | No | Author of the article |
| `itemDescription` | string (max 1000) | No | Brief description/excerpt from the article |
| `itemImage` | uri | No | Preview image URL for the article |
| `itemGuid` | string (max 512) | No | Unique identifier (guid) of the article from the feed |
| `itemPublishedAt` | datetime | No | Original publish date of the article |
| `note` | string (max 3000) | No | User's commentary or note about the share |
| `tags` | array of string (max 5 items, each max 64) | No | User-defined tags |
| `createdAt` | datetime | Yes | When the share was created |

---

### `app.skyreader.social.follow`

An in-app follow relationship to another Skyreader user. This is separate from Bluesky's native follow system.

**Schema Location:** `lexicons/app/skyreader/social/follow.json`

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `subject` | did | Yes | DID of the user being followed |
| `createdAt` | datetime | Yes | When the follow was created |

---

### `app.skyreader.social.shareReadPosition`

Read status for a social share. Tracks which shared articles from followed users have been read.

**Schema Location:** `lexicons/app/skyreader/social/shareReadPosition.json`

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `shareUri` | at-uri | Yes | AT URI of the share record being marked as read |
| `shareAuthorDid` | did | No | DID of the share author |
| `itemUrl` | uri | No | URL of the shared article (cached) |
| `itemTitle` | string (max 512) | No | Cached title of the shared article |
| `readAt` | datetime | Yes | When the share was marked as read |

---

## AT Protocol Data Types

### Special Formats

| Format | Description | Example |
|--------|-------------|---------|
| `uri` | Standard URL | `https://example.com/feed.xml` |
| `at-uri` | AT Protocol URI referencing a record | `at://did:plc:abc123/app.skyreader.feed.subscription/3abc` |
| `did` | Decentralized Identifier | `did:plc:abc123def456` |
| `datetime` | ISO 8601 timestamp | `2024-01-15T10:30:00.000Z` |

### AT URI Format

AT URIs follow the pattern: `at://<did>/<collection>/<rkey>`

- **did**: The user's decentralized identifier
- **collection**: The NSID of the record type (e.g., `app.skyreader.feed.subscription`)
- **rkey**: The record key (typically a `tid`)

Example: `at://did:plc:abc123/app.skyreader.feed.subscription/3k2abc456def`

## Data Storage

All lexicon records are stored in the user's Personal Data Server (PDS):

- **Subscriptions**: Stored in PDS, cached locally in IndexedDB
- **Read positions**: Stored in PDS, synced via background queue
- **Shares**: Written to PDS, aggregated by backend via Jetstream
- **Follows**: Stored in PDS
- **Share read positions**: Stored in PDS

This decentralized storage model gives users full ownership and portability of their data.
