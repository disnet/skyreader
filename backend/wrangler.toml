name = "skyreader-api"
main = "src/index.ts"
compatibility_date = "2025-09-27"

[observability]
enabled = true

# Durable Objects for realtime hub
[durable_objects]
bindings = [
  { name = "REALTIME_HUB", class_name = "RealtimeHub" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["JetstreamConsumer"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["RealtimeHub"]

[[migrations]]
tag = "v3"
deleted_classes = ["JetstreamConsumer"]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "skyreader"
database_id = "94dbfd9e-3e55-4551-a812-75ce4bc8339f"

# Environment variables
[vars]
FRONTEND_URL = "https://skyreader.pages.dev"

# Cron Triggers - run every minute for Jetstream polling
[triggers]
crons = ["* * * * *"]

# Development environment
[env.dev]
vars = { FRONTEND_URL = "http://127.0.0.1:5173" }
